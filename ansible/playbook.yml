---
- hosts: localhost
  vars:
    common_packages:  # these have the same name on all systems
     - git
     - mercurial
     - vim
     - ranger
     - neofetch
     - entr
     - fd-find
     - p7zip
     
    debian_packages:  # names specific for Ubuntu/Debian
     - git-extras     # git pr
     - lxd-client
     - apt-listchanges  # https://askubuntu.com/questions/272215/seeing-apt-get-changelogs-for-to-be-upgraded-packages
     - silversearcher-ag
     
    redhat_packages:  # names from RedHat/Fedora
     - lxc-extra
     - pv
     - the_silver_searcher

  tasks:
  # --- install software
  - name: ubuntu/debian - install packages
    apt:
      pkg: "{{ common_packages + debian_packages }}"
      force_apt_get: yes
    become: yes
    when: ansible_os_family == "Debian"

  - name: fedora - install packages
    yum: name="{{ common_packages + redhat_packages }}"
    become: yes
    when: ansible_os_family == "RedHat"

  # --- add common aliases
  - name: alias fdfind -> fd for Ubuntu/Debian
    file:
      src: "/usr/bin/fdfind"
      dest: "{{ ansible_env.HOME }}/bin/fd"
      state: link
    #debug: var=ansible_env.HOME
    when: ansible_os_family == "Debian"


  # --- checkout software from sources
  - name: hg extensions in ~/.hgext
    file: path=~/.hgext state=directory

  - name: fetch hgsubversion
    hg: dest=~/.hgext/hgsubversion repo=https://bitbucket.org/durin42/hgsubversion
  #  - name: enable hgsubversion
  #    ini_file: dest=~/.hgrc section=extensions option=hgsubversion value=~/.hgext/hgsubversion/hgsubversion

  - name: fetch hg-git
    hg: dest=~/.hgext/hg-git repo=https://foss.heptapod.net/mercurial/hg-git

  - name: enable hg mq
    ini_file: dest=~/.hgrc section=extensions option=mq value=
